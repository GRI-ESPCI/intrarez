{% extends "base.html" %}

{% block app_content %}

<script src="{{ url_for("static", filename="js/main-profile.js") }}"
        defer></script>

<div class="row mb-3">
    <div class="col">
        <h1>{{ _("Bonjour, %(name)s !", name=current_user.prenom) }}</h1>
    </div>
</div>
<div class="row">
    <div class="col"><p>
        {{ _("Bienvenue sur l'IntraRez ! Cette version moderne du vieux site "
             "d'enregistrement que vous avez peut-être connu n'en est encore "
             "qu'à ses balbutiements, et nous avons plein d'idées de "
             "fonctionnalités qui devraient voir le jour sous peu.") }}
    </p></div>
</div>
<div class="row mb-3">
    <div class="col"><p>
        {{ _("Une idée, un commentaire ? N'hésitez pas à ") }}
        <a href="{{ url_for("main.contact") }}">{{ _("nous en faire part") }}
        </a> !
    </p></div>
</div>
<div class="row row-cols row-cols-xl-3 gy-4 gx-1">
    <div class="col"><div class="card p-card bg-pc5 border-pc4 border-2 h-100">
        <div class="card-body d-flex align-items-center mb-2">
            <h3 class="card-title me-auto my-0">{{ _("Mon profil") }}</h3>
                <svg class="bi flex-shrink-0" width="36" height="36"
                     role="img">{{ bootstrap_icon("person-badge") }}
                </svg>
        </div>
        <div class="h-100">
            <table class="table table-striped table-borderless"><tbody>
                <tr><th scope="row" class="ps-4">{{ _("Mon compte") }}</th>
                    <td>{{ current_user.username }}</td></tr>
                <tr><th scope="row" class="ps-4">{{ _("Ma chambre") }}</th>
                    <td>{{ current_user.current_room.num }}</td></tr>
                <tr><th scope="row" class="ps-4">{{ _("Nombre d'appareils") }}
                    </th>
                    <td>{{ len(current_user.devices) }}</td></tr>
            </tbody></table>
        </div>
        <div class="card-body">
            <a href="{{ url_for("main.profile") }}"
               class="btn btn-outline-dark">
                {{ _("Voir mon profil") }}
            </a>
        </div>
    </div></div>

    <div class="col"><div class="card p-card bg-pc5 border-pc4 border-2 h-100">
        <div class="card-body d-flex align-items-center mb-2">
            <h3 class="card-title me-auto my-0">{{ _("Mon abonnement") }}</h3>
                <svg class="bi flex-shrink-0" width="36" height="36"
                     role="img">{{ bootstrap_icon("coin") }}
                </svg>
        </div>
        <div class="h-100">
            {% if current_user.computed_sub_state == SubState.subscribed %}

            <table class="table table-striped table-borderless"><tbody>
                <tr><th scope="row" class="ps-4">{{ _("État") }}</th>
                    <td><div class="m-auto position-relative pe-3">
                        {{ _("En règle") }}
                        <svg class="ms-2 bi flex-shrink-0 position-absolute
                                    top-50 translate-middle-y text-success"
                             width="24" height="24" role="img">
                            {{ bootstrap_icon("check-circle") }}
                        </svg>
                    </div></td>
                </tr>
                <tr><th scope="row" class="ps-4">{{ _("Jusqu'au") }}</th>
                    <td>{{ moment(
                            current_user.current_subscription.end
                        ).format("LL") }}</td></tr>
                <tr><th scope="row" class="ps-4">{{ _("Coupure le") }}</th>
                    <td>{{ moment(
                            current_user.current_subscription.cut_day
                        ).format("LL") }}</td></tr>
            </tbody></table>

            {% elif current_user.computed_sub_state == SubState.trial %}

            <table class="table table-striped table-borderless"><tbody>
                <tr><th scope="row" class="ps-4">{{ _("État") }}</th>
                    <td><div class="m-auto position-relative pe-3">
                        {{ _("Mois offert") }}
                        <svg class="ms-2 bi flex-shrink-0 position-absolute
                                    top-50 translate-middle-y text-warning"
                             width="24" height="24" role="img">
                            {{ bootstrap_icon("circle-fill") }}
                        </svg>
                        <svg class="ms-2 bi flex-shrink-0 position-absolute
                                    top-50 translate-middle-y text-danger"
                             width="24" height="24" role="img">
                            {{ bootstrap_icon("exclamation-circle") }}
                        </svg>
                    </div></td>
                </tr>
                <tr><th scope="row" class="ps-4">{{ _("Depuis le") }}</th>
                    <td>{{ moment(
                            current_user.current_subscription.end
                        ).format("LL") }}</td></tr>
                <tr><th scope="row" class="ps-4">{{ _("Coupure le") }}</th>
                    <td>{{ moment(
                            current_user.current_subscription.cut_day
                        ).format("LL") }}</td></tr>
            </tbody></table>

            {% else %}

            <table class="table table-striped table-borderless"><tbody>
                <tr><th scope="row" class="ps-4">{{ _("État") }}</th>
                    <td><div class="m-auto position-relative pe-3">
                        {{ _("Paiement nécessaire") }}
                        <svg class="ms-2 bi flex-shrink-0 position-absolute
                                    top-50 translate-middle-y text-danger"
                             width="24" height="24" role="img">
                            {{ bootstrap_icon("x-circle-fill") }}
                        </svg>
                    </div></td>
                </tr>
                <tr><th scope="row" class="ps-4">{{ _("Depuis le") }}</th>
                    <td>{{ moment(
                            current_user.old_subscriptions[0].cut_day
                            if current_user.old_subscriptions
                            else current_user.first_access
                        ).format("LL") }}</td></tr>
                <tr><th scope="row" class="ps-4">{{ _("Accès Internet") }}</th>
                    <td>{{ _("Suspendu") }}</td></tr>
            </tbody></table>

            {% endif %}
        </div>
        <div class="card-body">
            <a href="{{ url_for("main.profile") }}" class="btn btn-outline-dark">
                {{ _("Voir mes paiements") }}
            </a>
            {% if current_user.computed_sub_state == SubState.subscribed %}

            <div class="d-inline-block me-3" data-bs-toggle="tooltip"
                 data-bs-placement="top"
                 title="{{ _("Renouvellement possible à partir de la fin de l'abonnement actuel") }}">
                <button class="ms-2 btn btn-outline-dark" disabled>
                    {{ _("Payer") }}
                </button>
            </div>

            {% elif current_user.computed_sub_state == SubState.trial %}

            <a href="{{ url_for("payments.pay") }}"
               class="btn btn-outline-dark btn-primary ms-2">
                {{ _("Payer") }}
            </a>

            {% else %}

            <a href="{{ url_for("payments.pay") }}"
               class="btn btn-danger btn-outline-dark text-white ms-2">
                {{ _("Payer") }}
            </a>

            {% endif %}
        </div>
    </div></div>

    <div class="col"><div class="card p-card bg-pc5 border-pc4 border-2 h-100">
        <div class="card-body d-flex align-items-center mb-2">
            <h3 class="card-title me-auto my-0">{{ _("À venir") }}</h3>
                <svg class="bi flex-shrink-0" width="36" height="36"
                     role="img">{{ bootstrap_icon("three-dots") }}
                </svg>
        </div>
        <table class="table table-striped table-borderless"><tbody>
            <tr><th class="ps-4">
                    <span class="placeholder col-6"></span>
                </th>
                <td>
                    <span class="placeholder col-4"></span>
                    <span class="placeholder col-6"></span>
                </td>
            </tr>
            <tr><th class="ps-4">
                    <span class="placeholder col-3"></span>
                </th>
                <td>
                    <span class="placeholder col-6"></span>
                </td>
            </tr>
            <tr><th class="ps-4">
                    <span class="placeholder col-5"></span>
                </th>
                <td>
                    <span class="placeholder col-3"></span>
                    <span class="placeholder col-4"></span>
                </td>
            </tr>
        </tbody></table>
        <div class="card-body">
            <a class="btn btn-dark disabled placeholder col-6">
            </a>
        </div>
    </div></div>

</div>

{% endblock %}
